package crawl4j.urlutilities;

import java.util.ArrayList;
import java.util.List;
import java.util.StringTokenizer;

public class URL_Utilities {
	//	Voici le principe de hiérarchie pour les navid (première séquence de chiffres indiquée après identifiant type de page dansl’url ( ex : /v- , /l-, /f-)…
	//	+ 2 chiffres pour chaque sous-strate ( car 99 nœuds max pourune même strate)
	//	 
	//	Root/Home : 1
	//	Root-1/Home magasin = 1XX
	//	Root-2/Rayon : 1XXXX
	//	Root-3/Sous-rayon : 1XXXXXX
	//	Root-4 : Sous-sous rayon : 1XXXXXXXX
	//	Root-5 : 1XXXXXXXXXX
	private static String Vitrine = "^http://([a-z0-9]*\\.)*www.cdiscount.com.*/v-.*";
	private static String FicheProduit  ="^http://([a-z0-9]*\\.)*www.cdiscount.com.*/f-.*";
	private static String ListeProduit = "^http://([a-z0-9]*\\.)*www.cdiscount.com.*/l-.*";
	private static String ListeProduitFiltre = "^http://([a-z0-9]*\\.)*www.cdiscount.com.*/lf-.*";
	private static String PageMarque = "^http://([a-z0-9]*\\.)*www.cdiscount.com.*/m-.*";
	private static String PageConcept = "^http://([a-z0-9]*\\.)*www.cdiscount.com.*/ct-.*";
	private static String SearchDexing = "^http://([a-z0-9]*\\.)*www.cdiscount.com.*/r-.*";

	public static String checkType(String url){
		if (url.matches(Vitrine)){
			return "Vitrine";
		}
		if (url.matches(ListeProduit)){
			return "ListeProduit";
		}
		if (url.matches(FicheProduit)){
			return "FicheProduit";
		}
		if (url.matches(ListeProduitFiltre)){
			return "ListeProduitFiltre";
		}
		if (url.matches(PageMarque)){
			return "PageMarque";
		}
		if (url.matches(PageConcept)){
			return "PageConcept";
		}
		if (url.matches(SearchDexing)){
			return "SearchDexing";
		}	
		return "Unknown";
	}

	public static String checkMagasin(String url){
		String magasin = "Unknown";
		if ("Vitrine".equals(checkType(url))||"ListeProduit".equals(checkType(url))||"FicheProduit".equals(checkType(url))){

			int vitrine_index=url.indexOf("/v-");
			int listeproduit_index=url.indexOf("/l-");
			int ficheproduit_index=url.indexOf("/f-");

			int index = Math.max(Math.max(vitrine_index, listeproduit_index),ficheproduit_index);
			// we here catch the navid			
			String truncated_url=url.substring(0,index);
			String navid = url.substring(index+3, url.indexOf("-", index+3));
			int navid_length = navid.length();
			System.out.println("Navid"+navid);

			// we here slice the truncated url
			truncated_url = truncated_url.replace("http://www.cdiscount.com/","");
			StringTokenizer tokenize = new StringTokenizer(truncated_url,"/");
			List<String> tokenList = new ArrayList<String>();
			while (tokenize.hasMoreTokens()){
				tokenList.add(tokenize.nextToken());
			}

			if (navid_length == 3){
				magasin=tokenList.get(tokenList.size()-3);
			}
			if (navid_length == 5){
				magasin=tokenList.get(tokenList.size()-5);
			}
			if (navid_length == 7){
				magasin=tokenList.get(tokenList.size()-7);
			}
			if (navid_length == 9){
				magasin=tokenList.get(tokenList.size()-9);
			}
			if (navid_length == 11){
				magasin=tokenList.get(tokenList.size()-11);
			}
			System.out.println("Magasin : "+magasin);

		}
		if ("SearchDexing".equals(checkType(url))){

		}
		if ("ListeProduitFiltre".equals(checkType(url))){
			// it will soon behave as the searchdexing
		}

		return magasin;
	}

	public static String checkRayon(String url){
		String rayon = "Unknown";
		url = url.replace("http://www.cdiscount.com/","");
		StringTokenizer tokenize = new StringTokenizer(url,"/");
		if (tokenize.hasMoreTokens()){
			tokenize.nextToken();
		}
		if (tokenize.hasMoreTokens()){
			rayon = tokenize.nextToken();
		}
		return rayon;
	}

	public static String checkProduit(String url){
		String produit = "Unknown";
		url = url.replace("http://www.cdiscount.com/","");
		StringTokenizer tokenize = new StringTokenizer(url,"/");
		if (tokenize.hasMoreTokens()){
			tokenize.nextToken();
		}
		if (tokenize.hasMoreTokens()){
			tokenize.nextToken();
		}
		if (tokenize.hasMoreTokens()){
			produit = tokenize.nextToken();
		}
		return produit;
	}

}
