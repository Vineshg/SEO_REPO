
package vsm;

import java.io.File;
import java.io.FileReader;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Properties;


public class ProcessOneRayonQualityScore {
	
	private static String config_path = "/home/sduprey/My_Code/My_Java_Workspace/SIMILARITY_METRICS/config/";
	public static Properties properties;
	public  static File stop_words;

	// threshold above which we deem the content too much similar !!
	//	private static double threshold = 0;
	private static Connection con = null;
	private static List<URLContentInfo>magasins_datas = new ArrayList<URLContentInfo>();


	public static void main(String[] args) {
		String magasin_to_analyse ="musique-cd-dvd/";
		if (args.length == 1){
			magasin_to_analyse = args[0];
		}
		loadProperties();
		// getting the french stop words 
		stop_words = new File(properties.getProperty("config.stop_words_path"));
		//magasin_to_filter=properties.getProperty("data.magasintofilter");
		String url = properties.getProperty("db.url");
		String user = properties.getProperty("db.user");
		String mdp = properties.getProperty("db.passwd");    
		// database variables
		try {
			con = DriverManager.getConnection(url, user, mdp);
			fetch_magasin_info(magasin_to_analyse);
			//fetch_rayon();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			System.out.println("Trouble with the database");
			System.exit(0);
		}
		analyse_magasin(magasin_to_analyse);
	}

	private static void analyse_magasin(String magasin_to_analyse){
		
	}
	
	private static void fetch_magasin_info(String magasin_to_analyse){
		// getting the URLs infos for each rayon
		PreparedStatement field_pst;
		try {
			field_pst  = con.prepareStatement("SELECT NB_ATTRIBUTES,ATTRIBUTES,URL,VENDOR,MAGASIN,RAYON,PRODUIT FROM CRAWL_RESULTS WHERE MAGASIN='" +magasin_to_analyse+ "'");
			ResultSet field_rs = field_pst.executeQuery();
			while (field_rs.next()) {
				URLContentInfo url_info = new URLContentInfo();
				int nb_attributes = field_rs.getInt(1);
				String attributes = field_rs.getString(2);
				String my_url = field_rs.getString(3);
				String my_vendor = field_rs.getString(4);
				String my_magasin = field_rs.getString(5);
				String my_rayon = field_rs.getString(6);
				String my_produit = field_rs.getString(7);
				url_info.setNb_attributes(nb_attributes);
				url_info.setAttributes(attributes);
				url_info.setUrl(my_url);
				url_info.setMagasin(my_magasin);
				url_info.setRayon(my_rayon);
				url_info.setProduit(my_produit);
				url_info.setVendor(my_vendor);
				magasins_datas.add(url_info);
			}
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			System.out.println("Database trouble with the magasin :"+magasin_to_analyse);
			e.printStackTrace();
		}
	}

	private static void loadProperties(){
		properties = new Properties();
		try {
			properties.load(new FileReader(new File(config_path+"properties")));
		} catch (Exception e) {
			System.out.println("Failed to load properties file!!");
			e.printStackTrace();
		}
	}

	public String getProperty(String key){
		return properties.getProperty(key);
	}
	public Properties getProperties(){
		return properties;
	}
}