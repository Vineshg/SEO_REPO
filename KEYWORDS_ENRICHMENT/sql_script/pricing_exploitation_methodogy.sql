# from pricing_keyword we create two subpricing tables for cdiscount, amazon
select keyword, url, search_position, search_volume, magasin, rayon, produit into cdiscount_pricing from pricing_keywords where domain='cdiscount.com'
select keyword, url, search_position, search_volume, magasin, rayon, produit into amazon_pricing from pricing_keywords where domain='amazon.fr'  

# creation d'index sur ses tables
CREATE INDEX ON cdiscount_pricing (keyword);
CREATE INDEX ON amazon_pricing (keyword);

# creation de tables de comparaison sur ces mots cl√©s
select CDISCOUNT_PRICING.keyword as cd_keyword, CDISCOUNT_PRICING.url as cd_url, CDISCOUNT_PRICING.search_volume as cd_search_volume, CDISCOUNT_PRICING.search_position as cd_search_position,CDISCOUNT_PRICING.magasin as magasin, CDISCOUNT_PRICING.rayon as rayon, CDISCOUNT_PRICING.produit as produit, AMAZON_PRICING.keyword as am_keyword, AMAZON_PRICING.url as am_url, AMAZON_PRICING.search_volume as am_search_volume, AMAZON_PRICING.search_position as am_search_position INTO CDISCOUNT_VS_AMAZON_PRICING from CDISCOUNT_PRICING LEFT OUTER JOIN AMAZON_PRICING  on( AMAZON_PRICING.keyword=CDISCOUNT_PRICING.keyword)
select CDISCOUNT_PRICING.keyword as cd_keyword, CDISCOUNT_PRICING.url as cd_url, CDISCOUNT_PRICING.search_volume as cd_search_volume, CDISCOUNT_PRICING.search_position as cd_search_position,AMAZON_PRICING.magasin as magasin, AMAZON_PRICING.rayon as rayon, AMAZON_PRICING.produit as produit, AMAZON_PRICING.keyword as am_keyword, AMAZON_PRICING.url as am_url, AMAZON_PRICING.search_volume as am_search_volume, AMAZON_PRICING.search_position as am_search_position INTO AMAZON_VS_CDISCOUNT_PRICING from AMAZON_PRICING LEFT OUTER JOIN CDISCOUNT_PRICING  on( AMAZON_PRICING.keyword=CDISCOUNT_PRICING.keyword)


# creation des extracts globaux
# where we are not and amazon is
select * from AMAZON_VS_CDISCOUNT_PRICING where cd_keyword is null order by am_search_volume desc
# where we are and amazon isn't
select * from CDISCOUNT_VS_AMAZON_PRICING where am_keyword is null order by cd_search_volume desc

# creation des extracts par magasin
# where we are not and amazon is
select * from AMAZON_VS_CDISCOUNT_PRICING where cd_keyword is null and magasin='informatique' order by am_search_volume desc
# where we are and amazon isn't
select * from CDISCOUNT_VS_AMAZON_PRICING where am_keyword is null and magasin='informatique' order by cd_search_volume desc
# where we are not and amazon is by magasin
select * from AMAZON_VS_CDISCOUNT_PRICING where cd_keyword is null and magasin='informatique' order by am_search_volume desc
select * from AMAZON_VS_CDISCOUNT_PRICING where cd_keyword is null and magasin='high-tech' order by am_search_volume desc
select * from AMAZON_VS_CDISCOUNT_PRICING where cd_keyword is null and magasin='Unknown' order by am_search_volume desc


# same study but by truncating for keywords with search_position
# creation des extracts globaux
# where we are not and amazon is
select * from AMAZON_VS_CDISCOUNT_PRICING where cd_keyword is null and am_search_position <= 15 order by am_search_volume desc
# where we are and amazon isn't
select * from CDISCOUNT_VS_AMAZON_PRICING where am_keyword is null and cd_search_position <= 15 order by cd_search_volume desc

# creation des extracts par magasin
# where we are not and amazon is
select * from AMAZON_VS_CDISCOUNT_PRICING where cd_keyword is null and magasin='informatique' order by am_search_volume desc
# where we are and amazon isn't
select * from CDISCOUNT_VS_AMAZON_PRICING where am_keyword is null and magasin='informatique' order by cd_search_volume desc
# where we are not and amazon is by magasin
select * from AMAZON_VS_CDISCOUNT_PRICING where cd_keyword is null and magasin='informatique' order by am_search_volume desc
select * from AMAZON_VS_CDISCOUNT_PRICING where cd_keyword is null and magasin='high-tech' order by am_search_volume desc
select * from AMAZON_VS_CDISCOUNT_PRICING where cd_keyword is null and magasin='Unknown' order by am_search_volume desc


